<h1 class="page-title">ダッシュボード</h1>

<div class="dashboard-container">
  <!-- カレンダーセクション -->
  <div class="dashboard-calendar">
    <div class="calendar-header">
      <h2 class="section-title"><%= @date.strftime("%Y年%m月") %></h2>
      <div class="calendar-nav">
        <%= link_to "前月", dashboard_path(date: @date.prev_month), class: "nav-btn" %>
        <%= link_to "今月", dashboard_path, class: "nav-btn" %>
        <%= link_to "翌月", dashboard_path(date: @date.next_month), class: "nav-btn" %>
      </div>
    </div>

    <div class="calendar">
      <div class="calendar-weekdays">
        <% %w[日 月 火 水 木 金 土].each do |day| %>
          <div class="weekday"><%= day %></div>
        <% end %>
      </div>

      <div class="calendar-days">
        <% (@start_date..@end_date).each do |date| %>
          <% records = @practice_records[date] || [] %>
          <% is_current_month = date.month == @date.month %>
          <% is_today = date == Date.today %>
          <% avg_condition = records.any? ? (records.sum(&:condition).to_f / records.size).round : nil %>

          <div class="calendar-day <%= 'other-month' unless is_current_month %> <%= 'today' if is_today %> <%= "has-records level-#{avg_condition}" if avg_condition %>">
            <div class="day-number"><%= date.day %></div>
            <% if records.any? %>
              <div class="day-info">
                <div class="record-count"><%= records.size %>件</div>
                <% if avg_condition %>
                  <div class="condition-badge">調子: <%= avg_condition %></div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- 統計セクション -->
  <div class="dashboard-statistics">
    <!-- 統計カード -->
    <div class="stats-cards-compact">
      <div class="stat-card-compact">
        <div class="stat-label">総練習記録</div>
        <div class="stat-value"><%= @total_records %>件</div>
      </div>
      <div class="stat-card-compact">
        <div class="stat-label">平均調子</div>
        <div class="stat-value"><%= @avg_condition || '-' %></div>
      </div>
      <div class="stat-card-compact">
        <div class="stat-label">この月の記録</div>
        <div class="stat-value"><%= @records_this_month %>件</div>
      </div>
    </div>

    <!-- グラフエリア -->
    <div class="chart-container-compact" data-controller="chart"
         data-chart-dashboard-mode-value="true"
         data-chart-dashboard-labels-value="<%= @current_month_data[:labels].to_json %>"
         data-chart-dashboard-data-value="<%= @current_month_data[:data].to_json %>">

      <div class="chart-header">
        <h2 class="section-title"><%= @date.strftime('%Y年%m月') %>の調子の推移</h2>
      </div>

      <canvas data-chart-target="canvas"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
